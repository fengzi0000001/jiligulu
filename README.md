# 🚀 Dreamina自动注册扩展

一个功能强大的Chrome扩展，用于自动创建企业邮箱账号、注册Dreamina AI账号，并在积分用完后自动切换新号。

## ✨ 主要功能

### 🔐 智能邮箱管理
- **自动登录邮箱管理后台** - 支持验证码识别
- **无限生成邮箱账号** - 使用自定义域名
- **智能CSRF保护** - 自动处理安全令牌
- **多重备用方案** - 冰拓OCR + 本地OCR + 模拟识别

### 🤖 Dreamina自动化
- **7步注册流程** - 完全自动化注册过程
- **智能表单填写** - 自动识别和填写表单字段
- **验证码处理** - 自动获取和提交验证码
- **状态监控** - 实时监控注册进度

### 🔄 智能账号管理
- **积分监控** - 自动检测积分使用情况
- **账号切换** - 积分用完后自动创建新号
- **无缝体验** - 用户无需手动干预

### 🛠️ 强大的诊断工具
- **网络连接测试** - 一键测试网络状态
- **详细错误日志** - 浮窗日志系统
- **问题诊断** - 自动识别和报告问题
- **状态监控** - 实时显示运行状态

## 📦 安装方法

### 方法1: 从源码安装
1. 下载或克隆项目到本地
2. 打开Chrome浏览器，进入 `chrome://extensions/`
3. 开启"开发者模式"
4. 点击"加载已解压的扩展程序"
5. 选择项目文件夹
6. 确认扩展已安装并启用

### 方法2: 打包安装
1. 在 `chrome://extensions/` 中点击"打包扩展程序"
2. 选择项目根目录
3. 生成 `.crx` 文件
4. 拖拽 `.crx` 文件到扩展页面安装

## ⚙️ 配置说明

### 邮箱系统配置
```javascript
const EMAIL_CONFIG = {
  adminUrl: 'http://mail.turtur.us:8010',           // 管理后台地址
  loginUrl: 'http://mail.turtur.us:8010/Index/login', // 登录页面
  webmailUrl: 'http://mail.turtur.us:8000',         // Webmail地址
  adminCredentials: { 
    username: 'ceshi',                              // 管理员账号
    password: 'ceshi123'                            // 管理员密码
  },
  defaultPassword: 'ceshi123',                       // 新邮箱默认密码
  domain: 'tiktokaccu.com'                          // 邮箱域名
};
```

### 验证码识别配置
```javascript
const BINGTOP_OCR_CONFIG = {
  apiUrl: 'http://www.bingtop.com/ocr/upload/',     // OCR服务地址
  username: '743471562',                            // 服务账号
  password: '743471562',                            // 服务密码
  captchaType: 1001,                                // 验证码类型
  timeout: 60000                                    // 超时时间
};
```

### Dreamina配置
```javascript
const DREAMINA_CONFIG = {
  baseUrl: 'https://dreamina.capcut.com',           // 基础URL
  loginUrl: 'https://dreamina.capcut.com/ai-tool/login', // 登录页面
  registerUrl: 'https://dreamina.capcut.com/ai-tool/login', // 注册页面
  userAgent: 'Mozilla/5.0...'                      // 用户代理
};
```

## 🚀 使用方法

### 1. 启动扩展
1. 点击浏览器工具栏中的扩展图标
2. 在popup界面中点击"开始自动注册"
3. 扩展将自动开始执行注册流程

### 2. 监控状态
- **浮窗日志**: 实时显示操作状态和进度
- **状态指示器**: popup界面显示当前状态
- **控制台日志**: 详细的调试信息

### 3. 停止扩展
- 点击"停止监控"按钮
- 扩展将安全停止所有操作

### 4. 网络测试
- **🌐 测试网络连接**: 全面测试网络状态
- **🔗 测试登录URL**: 专门测试登录URL连接

## 🔍 故障排除

### 常见问题

#### 问题1: 启动失败，请检查扩展权限
**解决方法**:
1. 确认扩展已启用
2. 检查 `chrome://extensions/` 中的权限设置
3. 重新安装扩展

#### 问题2: 状态码0错误
**解决方法**:
1. 使用内置测试功能诊断网络连接
2. 参考 `状态码0问题诊断指南.md`
3. 检查服务器状态和网络连接

### 问题3: CORS错误
**解决方法**:
1. 这是正常的浏览器安全机制
2. 参考 `CORS问题说明.md`
3. 使用内置测试功能避免CORS错误
4. 专注于测试您实际需要的URL

### 问题4: 连接建立失败
**解决方法**:
1. 扩展现在具备自动连接管理功能
2. 参考 `连接问题解决方案.md`
3. 重新加载扩展并刷新页面
4. 使用内置测试功能验证连接状态

### 问题5: Service Worker兼容性问题
**解决方法**:
1. 扩展已完全兼容Service Worker环境
2. 参考 `Service Worker兼容性问题说明.md`
3. 使用fetch API替代XMLHttpRequest
4. 所有HTTP请求现在都兼容Service Worker

### 问题6: 各种错误诊断和解决
**解决方法**:
1. 扩展现在具备完整的错误诊断能力
2. 参考 `错误诊断和解决指南.md`
3. 使用内置测试功能进行诊断
4. 根据错误类型获取解决建议

### 问题7: 登录请求失败（状态码0）
**解决方法**:
1. 扩展现在具备多配置重试机制
2. 参考 `登录问题诊断指南.md`
3. 自动尝试不同请求配置
4. 运行专门的登录请求诊断

### 问题8: 邮箱创建失败（Failed to fetch）
**解决方法**:
1. 扩展现在具备多配置重试机制
2. 参考 `邮箱创建问题诊断指南.md`
3. 自动尝试不同请求配置
4. 运行专门的邮箱创建诊断

### 问题9: 请求头差异导致的服务器拒绝
**解决方法**:
1. 扩展现在具备自动请求头差异分析
2. 参考 `请求头差异分析指南.md`
3. 自动检测缺失的请求头
4. 智能补全重要的请求头

### 问题10: Dreamina按钮查找失败
**解决方法**:
1. 扩展现在具备增强版多选择器支持
2. 参考 `Dreamina按钮查找问题诊断指南.md`
3. 支持多语言界面（中英文）
4. 智能文本查找和元素定位

#### 问题3: OCR识别失败
**解决方法**:
1. 检查冰拓OCR服务配置
2. 确认网络连接正常
3. 查看详细错误日志

### 诊断工具

#### 内置测试功能
- **网络连接测试**: 全面诊断网络状态
- **URL连接测试**: 测试特定URL的可达性
- **状态监控**: 实时监控扩展运行状态

#### 扩展测试页面
- **test-extension.html**: 完整的扩展功能测试页面
- **基础功能测试**: 扩展状态、消息传递、存储功能
- **网络连接测试**: 网络状态、URL可达性、手动测试
- **系统功能测试**: 邮箱系统、Webmail、Dreamina连接
- **完整诊断**: 系统环境、扩展状态、问题分析

#### 日志系统
- **浮窗日志**: 实时显示操作状态
- **控制台日志**: 详细的调试信息
- **错误追踪**: 完整的错误堆栈信息

## 📁 项目结构

```
即梦/
├── manifest.json              # 扩展清单文件
├── background-simple.js       # 后台服务脚本
├── popup.html                 # 弹出界面
├── popup.js                   # 弹出界面脚本
├── content.js                 # 内容脚本
├── floating-log.js            # 浮窗日志系统
├── icons/                     # 图标文件夹
│   ├── icon16.png
│   ├── icon48.png
│   └── icon128.png
├── 状态码0问题深度修复说明.md  # 状态码0问题深度修复
├── 验证码识别失败问题修复说明.md # 验证码识别失败问题修复
├── CORS问题说明.md            # CORS问题详细说明
├── 连接问题解决方案.md        # 连接问题解决方案
├── Service Worker兼容性问题说明.md # Service Worker兼容性说明
├── 错误诊断和解决指南.md      # 错误诊断和解决指南
├── 登录问题诊断指南.md        # 登录问题诊断指南
├── 邮箱创建问题诊断指南.md    # 邮箱创建问题诊断指南
├── 请求头差异分析指南.md      # 请求头差异分析指南
├── Dreamina按钮查找问题诊断指南.md # Dreamina按钮查找问题诊断指南
├── 快速测试指南.md            # 快速测试指南
├── 邮箱管理后台登录流程说明.md # 登录流程说明
├── Dreamina注册流程说明.md    # 注册流程说明
├── test-extension.html        # 扩展功能测试页面
└── README.md                  # 项目说明文档
```

## 🔧 技术特性

### 核心技术
- **Chrome Extension Manifest V3** - 最新的扩展标准
- **Service Worker** - 后台服务处理
- **Content Scripts** - 页面交互
- **Message Passing** - 组件间通信

### 网络处理
- **Fetch API** - 现代网络请求
- **XMLHttpRequest** - 备用请求方式
- **CORS处理** - 跨域请求支持
- **错误重试** - 智能重试机制

### 验证码识别
- **冰拓OCR服务** - 专业验证码识别
- **本地OCR** - Tesseract.js备用方案
- **图像预处理** - Canvas图像处理
- **多重降级** - 智能备用方案

### 自动化流程
- **DOM操作** - 智能元素识别
- **事件模拟** - 真实用户操作
- **状态检测** - 智能流程控制
- **错误恢复** - 自动错误处理

### 连接管理
- **自动检测** - 智能检测连接状态
- **自动恢复** - 失败时自动重新注入脚本
- **智能降级** - 连接失败时使用控制台日志
- **多重备用** - 多种连接恢复策略

### Service Worker兼容性
- **完全兼容** - 支持Manifest V3的Service Worker
- **fetch API** - 替代XMLHttpRequest，更现代
- **响应标准化** - 统一的响应对象接口
- **错误处理** - 改进的错误处理机制

### 错误诊断和解决
- **自动诊断** - 网络错误时自动运行诊断
- **智能建议** - 根据错误类型提供解决建议
- **内置测试** - 网络连接和URL测试功能
- **详细日志** - 完整的错误信息和诊断报告

### 登录问题诊断
- **多配置重试** - 自动尝试不同请求配置
- **专门诊断** - 针对登录请求的专门诊断
- **渐进式优化** - 从复杂到简单的配置尝试
- **超时保护** - 防止请求无限等待

### 邮箱创建问题诊断
- **多配置重试** - 自动尝试不同请求配置
- **专门诊断** - 针对邮箱创建的专门诊断
- **CSRF Token处理** - 智能提取和验证安全令牌
- **会话状态检查** - 验证登录会话有效性

### 请求头差异分析
- **自动检测** - 检测到网络错误时自动分析
- **智能分析** - 对比浏览器vs扩展请求头
- **重要性排序** - 按重要性排序缺失的头
- **智能补全** - 自动添加缺失的重要请求头

### Dreamina按钮查找增强
- **多选择器支持** - 尝试多种选择器策略
- **多语言支持** - 支持中英文界面
- **智能文本查找** - 基于文本内容的智能查找
- **详细日志记录** - 完整的查找过程记录

### 状态码0问题深度修复
- **超时检测** - 使用AbortController精确控制30秒超时
- **中断检测** - 自动检测AbortError（超时或中断）
- **特殊处理** - 专门处理状态码0（网络中断或超时）
- **服务器验证** - 使用GET请求验证服务器状态
- **备选验证** - 会话验证作为备选方案
- **智能重试** - 增强的重试配置和错误分类

## 📊 性能指标

### 响应时间
- **网络请求**: < 200ms (正常网络)
- **OCR识别**: < 5s (冰拓服务)
- **页面操作**: < 1s (标准操作)
- **状态更新**: < 100ms (实时反馈)

### 成功率
- **邮箱创建**: > 95%
- **验证码识别**: > 90%
- **账号注册**: > 85%
- **整体流程**: > 80%

### 资源占用
- **内存使用**: < 50MB
- **CPU占用**: < 5% (空闲时)
- **网络流量**: < 1MB/次操作

## 🚨 注意事项

### 使用限制
1. **仅限个人使用** - 请勿用于商业用途
2. **遵守服务条款** - 遵守相关网站的使用条款
3. **合理使用频率** - 避免过于频繁的操作
4. **保护隐私信息** - 注意账号信息安全

### 技术限制
1. **浏览器兼容性** - 仅支持Chrome 88+
2. **网络要求** - 需要稳定的网络连接
3. **服务器状态** - 依赖外部服务可用性
4. **验证码质量** - 识别成功率受图片质量影响

### 安全考虑
1. **权限最小化** - 仅请求必要权限
2. **数据本地化** - 敏感数据不发送到外部
3. **错误处理** - 完善的错误处理机制
4. **日志清理** - 定期清理敏感日志

## 🔮 未来计划

### 功能增强
- [ ] 支持更多邮箱系统
- [ ] 增加更多AI平台支持
- [ ] 智能积分预测
- [ ] 批量账号管理

### 性能优化
- [ ] 并发处理优化
- [ ] 缓存机制改进
- [ ] 网络请求优化
- [ ] 内存使用优化

### 用户体验
- [ ] 更友好的界面设计
- [ ] 多语言支持
- [ ] 自定义配置界面
- [ ] 操作历史记录

## 📞 技术支持

### 问题反馈
如果遇到问题，请提供以下信息：
1. **错误日志** - 完整的错误信息
2. **操作步骤** - 详细的重现步骤
3. **环境信息** - 浏览器版本、操作系统
4. **网络状态** - 网络连接情况

### 联系方式
- **GitHub Issues**: 提交问题报告
- **文档参考**: 查看相关文档
- **社区支持**: 寻求社区帮助

## 📄 许可证

本项目仅供学习和研究使用，请遵守相关法律法规和服务条款。

## 🙏 致谢

感谢以下开源项目和服务：
- **Chrome Extension API** - 扩展开发框架
- **Tesseract.js** - OCR识别库
- **冰拓验证码识别** - 专业OCR服务
- **开源社区** - 技术支持和贡献

---

**🚀 开始使用扩展，体验智能自动化带来的便利！**

如有问题，请参考故障排除部分或提交问题反馈。
